# rp2040-micropython-neopixel-spectrum
Audio spectrum visualizer for RP2040 in MicroPython with WS2812B 16√ó16 NeoPixel matrix output.  
---
–û–±—á–∏—Å–ª–µ–Ω–Ω—è —Å–ø–µ–∫—Ç—Ä–∞ –∞—É–¥—ñ–æ—Å–∏–≥–Ω–∞–ª—É —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –π–æ–≥–æ –Ω–∞ RGB LED-–º–∞—Ç—Ä–∏—Ü—ñ **WS2812B 16√ó16** (NeoPixel) —É **MicroPython** –Ω–∞ **RP2040 (Raspberry Pi Pico)**.

---

## üì¶ –û—Å–Ω–æ–≤–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

### –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è

- –î—ñ–∞–ø–∞–∑–æ–Ω —á–∞—Å—Ç–æ—Ç, —è–∫–∏–π –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä, **–Ω–µ —î —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–º** —ñ –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
  - `Fs` / `SAMPLE_FREQ` ‚Äî —á–∞—Å—Ç–æ—Ç–∞ —Å–µ–º–ø–ª—É–≤–∞–Ω–Ω—è (–ì—Ü)
  - `N` / `FFT_SIZE` ‚Äî —Ä–æ–∑–º—ñ—Ä FFT
  - `IND_BANDS` ‚Äî —Ä–æ–∑–±–∏—Ç—Ç—è FFT-–±—ñ–Ω—ñ–≤ –Ω–∞ —Å–º—É–≥–∏ (—è–∫—ñ –±—ñ–Ω–∏ —Ä–µ–∞–ª—å–Ω–æ –≤—ñ–∑—É–∞–ª—ñ–∑—É—é—Ç—å—Å—è)
    
(–¥–∏–≤. —Ä–æ–∑–¥—ñ–ª ‚Äú–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¥—ñ–∞–ø–∞–∑–æ–Ω—É —á–∞—Å—Ç–æ—Ç‚Äù)

- **16 —á–∞—Å—Ç–æ—Ç–Ω–∏—Ö —Å–º—É–≥** (–æ–±–º–µ–∂—É—î—Ç—å—Å—è LED-–º–∞—Ç—Ä–∏—Ü—é WS2812B)
- **16 —Ä—ñ–≤–Ω—ñ–≤ (0..16)** –¥–ª—è –∫–æ–∂–Ω–æ—ó —Å–º—É–≥–∏, –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –≤—ñ–¥ `dBFS`
- –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –º–∞—Å—à—Ç–∞–± **AGC –ø–æ —Å–º—É–≥–∞—Ö** (—Å—Ç–∞–±—ñ–ª—å–Ω–µ –≤—ñ–∑—É–∞–ª—å–Ω–µ —Å–ø—ñ–≤–≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è —Å–∫–ª–∞–¥–æ–≤–∏—Ö –ø—Ä–∏ –∑–º—ñ–Ω—ñ –≥—É—á–Ω–æ—Å—Ç—ñ)
- –ß–∞—Å—Ç–æ—Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω–¥–∏–∫–∞—Ü—ñ—ó: **~14 FPS** (–∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —Ç–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó; –¥–∏–≤. —Ä–æ–∑–¥—ñ–ª ‚Äú–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å‚Äù)

### FFT
- –†–æ–∑–º—ñ—Ä: **N = 1024**
- –í—ñ–∫–Ω–æ: **Hann window** (–≤—ñ–∫–Ω–æ –•–∞–Ω–Ω–∞), **Hamming window** (–í—ñ–∫–Ω–æ –ì–µ–º–º—ñ–Ω–≥–∞), –∞–±–æ –±–µ–∑ –≤—ñ–∫–Ω–∞
- –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è FFT: **kissFFT (float)** + –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó –≤ C —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å `fastfft`  
  –†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π: https://github.com/Alex-Teteria/Fast-FFT-module-for-MicroPython-RP2040-

### ADC (RP2040)
- –í–∏–±—ñ—Ä —á–∞—Å—Ç–æ—Ç–∏ —Å–µ–º–ø–ª—É–≤–∞–Ω–Ω—è `Fs` —Ä–æ–±–∏—Ç—å—Å—è –ø—ñ–¥ —Ü—ñ–ª—å–æ–≤–∏–π –≤–µ—Ä—Ö–Ω—ñ–π –∫—Ä–∞–π –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó `f_show_max`:
  - –ó–∞–¥–∞—Ç–∏ –±–∞–∂–∞–Ω—É –≤–µ—Ä—Ö–Ω—é —á–∞—Å—Ç–æ—Ç—É –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è `f_show_max` (—â–æ —Ä–µ–∞–ª—å–Ω–æ –º–∞—î —Å–µ–Ω—Å –¥–ª—è –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞/–ø—ñ–¥—Å–∏–ª—é–≤–∞—á–∞).
  - –í–∏–±—Ä–∞—Ç–∏ `Fs` —Ç–∞–∫, —â–æ–± **Nyquist –±—É–≤ –≤–∏—â–µ** `f_show_max` —ñ–∑ –∑–∞–ø–∞—Å–æ–º (guard band), –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
     - –ø—Ä–∞–∫—Ç–∏—á–Ω–µ –ø—Ä–∞–≤–∏–ª–æ: `Fs >= (2.2 ‚Ä¶ 2.5) * f_show_max`
  - –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –≤–∏–±—Ä–∞–Ω—ñ `Fs` —ñ `FFT_SIZE` –¥–∞—é—Ç—å –ø—Ä–∏–π–Ω—è—Ç–Ω—É —Ä–æ–∑–¥—ñ–ª—å–Ω—É –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å:
     - `Œîf = Fs / FFT_SIZE`
  - –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ —á–∞—Å –∑–∞—Ö–≤–∞—Ç—É –∫–∞–¥—Ä–∞ –≤–ø–∏—Å—É—î—Ç—å—Å—è —É –±—é–¥–∂–µ—Ç –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—ñ/–æ–Ω–æ–≤–ª–µ–Ω–Ω—è:
    - `T_acq = FFT_SIZE / Fs`
- –ó–∞—Ö–≤–∞—Ç: C-–º–æ–¥—É–ª—å `adc_dma` (one-shot/burst, –∞–ø–∞—Ä–∞—Ç–Ω–µ —Ç–∞–∫—Ç—É–≤–∞–Ω–Ω—è, DMA —É RAM)  
  –†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π: https://github.com/Alex-Teteria/MicroPython-RP2040-ADC-DMA-Extension
- –û–∫—Ä–µ–º–∏–π –∞–Ω–∞–ª–æ–≥–æ–≤–∏–π –∞–Ω—Ç–∏–∞–ª—ñ–∞—Å–æ–≤–∏–π —Ñ—ñ–ª—å—Ç—Ä –º–æ–∂–ª–∏–≤–æ –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏; –≤—Ö—ñ–¥–Ω–∏–π —Ç—Ä–∞–∫—Ç (–µ–ª–µ–∫—Ç—Ä–µ—Ç–Ω–∏–π –º—ñ–∫—Ä–æ—Ñ–æ–Ω + –º—ñ–∫—Ä–æ—Ñ–æ–Ω–Ω–∏–π –ø—ñ–¥—Å–∏–ª—é–≤–∞—á) –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –∞—É–¥—ñ–æ –π –º–∞—î –æ–±–º–µ–∂–µ–Ω—É –∫–æ—Ä–∏—Å–Ω—É —Å–º—É–≥—É. –î–ª—è –∑–º–µ–Ω—à–µ–Ω–Ω—è –≤–ø–ª–∏–≤—É –º–æ–∂–ª–∏–≤–∏—Ö –í–ß –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤ —Å–ª—ñ–¥ –≤–∏–±—Ä–∞—Ç–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è. –ó–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –í–ß –ø–µ—Ä–µ—à–∫–æ–¥ –º–æ–∂–ª–∏–≤–∏–π –∞–ª—ñ–∞—Å–∏–Ω–≥; —É —Ç–∞–∫–æ–º—É —Ä–∞–∑—ñ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø—Ä–æ—Å—Ç–∏–π RC low-pass –ø–µ—Ä–µ–¥ ADC.

---

## üèóÔ∏è –ê–ø–∞—Ä–∞—Ç–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ —Ç–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

### –ú–æ–¥—É–ª—ñ
- MAX4466 –∞–±–æ MAX9814, electret mic amplifier module (–º—ñ–∫—Ä–æ—Ñ–æ–Ω + –ø—ñ–¥—Å–∏–ª—é–≤–∞—á)
- WS2812B RGB LED matrix 16√ó16 (256 LED)
- Raspberry Pi Pico / RP2040

### –ñ–∏–≤–ª–µ–Ω–Ω—è —Ç–∞ —Å–∏–≥–Ω–∞–ª–∏
- MAX4466 (MAX9814) –∂–∏–≤–∏—Ç–∏ –≤—ñ–¥ **3.3V** Pico.
- –í–∏—Ö—ñ–¥ MAX4466 –º–∞—î **DC offset ~VCC/2**, MAX9814 –º–∞—î **DC offset ~1,25–í** —Ç–æ–º—É –º–æ–∂—É—Ç—å –ø–æ–¥–∞–≤–∞—Ç–∏—Å—å –Ω–∞–ø—Ä—è–º—É –Ω–∞ ADC.
- LED-–º–∞—Ç—Ä–∏—Ü—é WS2812B –∂–∏–≤–∏—Ç–∏ –≤—ñ–¥ **5V –æ–∫—Ä–µ–º–∏–º –¥–∂–µ—Ä–µ–ª–æ–º** (—Å—Ç—Ä—É–º –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —è—Å–∫—Ä–∞–≤–æ—Å—Ç—ñ —Ç–∞ –∫–æ–ª—å–æ—Ä—ñ–≤).
- –û–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –∑—Ä–æ–±–∏—Ç–∏ **—Å–ø—ñ–ª—å–Ω—É –∑–µ–º–ª—é (GND)** –º—ñ–∂ Pico —Ç–∞ 5V LED-–¥–∂–µ—Ä–µ–ª–æ–º.
- DATA –ª—ñ–Ω—ñ—è WS2812B:
  - –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ —Ä–µ–∑–∏—Å—Ç–æ—Ä **330‚Äì470 Œ©** —É DATA –±—ñ–ª—è –≤—Ö–æ–¥—É –º–∞—Ç—Ä–∏—Ü—ñ.

### –ü—ñ–Ω–∏ 
- ADC: GPIO26 / ADC0
- NeoPixel DATA: GPIO20 (–≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î `neo_pin=20` —É –∫–æ–¥—ñ)

---

## üß© –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è / –ø—Ä–æ—à–∏–≤–∫–∞

–ü—Ä–æ—î–∫—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –º–æ–¥—É–ª—ñ `adc_dma` —Ç–∞ `fastfft`. –ü–æ—Ç—Ä—ñ–±–Ω–∞ –∑–±—ñ—Ä–∫–∞ MicroPython –¥–ª—è RP2040, –¥–µ —Ü—ñ C-–º–æ–¥—É–ª—ñ –≤—à–∏—Ç—ñ —É –ø—Ä–æ—à–∏–≤—Ü—ñ.

–î–∞–ª—ñ:
1. –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–∞ Pico —Ñ–∞–π–ª–∏:
   - `neo_spectr.py`
   - `neo_matrix.py`
   - `build_band_spectr.md` (–¥–æ–≤—ñ–¥–∫–∞)
2. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ `neo_spectr.py`.

---

## :page_facing_up: –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤

| –§–∞–π–ª | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
| --- | --- |
| `neo_spectr.py` | –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–¥ (ADC ‚Üí FFT ‚Üí 16 —Å–º—É–≥ ‚Üí LED) |
| `neo_matrix.py` | –ö–ª–∞—Å `NeoMatrixFast` –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä—É WS2812B 16√ó16 (viper + –ø—Ä—è–º–∏–π –±—É—Ñ–µ—Ä) |
| `build_band_spectr.md` | –û–ø–∏—Å –∞–ª–≥–æ—Ä–∏—Ç–º—É —Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —Ñ—É–Ω–∫—Ü—ñ—ó `build_band_spectr()` |

---

## ‚öôÔ∏è –ö–ª—é—á–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏

- `FFT_SIZE = 1024`
- `SAMPLE_FREQ = 44_000`
- `IND_BANDS` ‚Äî —Ä–æ–∑–±–∏—Ç—Ç—è –±—ñ–Ω—ñ–≤ FFT –Ω–∞ 16 —Å–º—É–≥
- `NOISE_THRESHOLD` ‚Äî –ø–æ—Ä–æ–≥–∏ —à—É–º—É –ø–æ —Å–º—É–≥–∞—Ö
- AGC –ø–∞—Ä–∞–º–µ—Ç—Ä–∏: `HEADROOM_DB`, `SCALE_DECAY_DB`, `SCALE_MIN_DB`, `GAMMA`

---
## :triangular_ruler: –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¥—ñ–∞–ø–∞–∑–æ–Ω—É —á–∞—Å—Ç–æ—Ç 


#### –ö—Ä–æ–∫ –ø–æ —á–∞—Å—Ç–æ—Ç—ñ (—Ä–æ–∑–¥—ñ–ª—å–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å FFT)
–î–ª—è real FFT –∑ —Ä–æ–∑–º—ñ—Ä–æ–º `N` —á–∞—Å—Ç–æ—Ç–Ω–∏–π –∫—Ä–æ–∫ –æ–¥–Ω–æ–≥–æ –±—ñ–Ω—É:

$$
\Delta f = \frac{Fs}{N}
$$

#### –í—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å "–±—ñ–Ω ‚Üí —á–∞—Å—Ç–æ—Ç–∞"
–ß–∞—Å—Ç–æ—Ç–∞ –±—ñ–Ω—É –∑ —ñ–Ω–¥–µ–∫—Å–æ–º `k`:

$$
f(k) = k \cdot \Delta f = k \cdot \frac{Fs}{N}
$$

–¥–µ:
- `k = 0` ‚Äî DC (0 –ì—Ü), –Ω–µ –≤—ñ–∑—É–∞–ª—ñ–∑—É—î—Ç—å—Å—è
- –≤–µ—Ä—Ö–Ω—è –º–µ–∂–∞ —Å–ø–µ–∫—Ç—Ä–∞ –æ–±–º–µ–∂–µ–Ω–∞ —á–∞—Å—Ç–æ—Ç–æ—é –ù–∞–π–∫–≤—ñ—Å—Ç–∞:

$$
f_{Nyq} = \frac{Fs}{2}
$$

#### –î—ñ–∞–ø–∞–∑–æ–Ω –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
–Ø–∫—â–æ —Ñ–∞–∫—Ç–∏—á–Ω–æ –≤—ñ–∑—É–∞–ª—ñ–∑—É—é—Ç—å—Å—è –±—ñ–Ω–∏ –≤—ñ–¥ `k_min` –¥–æ `k_max` (–≤–∫–ª—é—á–Ω–æ), —Ç–æ –ø—Ä–∏–±–ª–∏–∑–Ω–∏–π –¥—ñ–∞–ø–∞–∑–æ–Ω –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è:

$$
f_{min} \approx k_{min} \cdot \frac{Fs}{N}, \quad
f_{max} \approx k_{max} \cdot \frac{Fs}{N}
$$

–ó–Ω–∞—á–µ–Ω–Ω—è `k_min` —ñ `k_max` –≤–∏–∑–Ω–∞—á–∞—é—Ç—å—Å—è —Ä–µ–∞–ª—å–Ω–æ—é –æ–±–ª–∞—Å—Ç—é –±—ñ–Ω—ñ–≤, —è–∫—É –ø–æ–∫—Ä–∏–≤–∞—î `IND_BANDS`
(—Ç–æ–±—Ç–æ –Ω–∞–π–º–µ–Ω—à–∏–π/–Ω–∞–π–±—ñ–ª—å—à–∏–π –±—ñ–Ω, —â–æ –≤—Ö–æ–¥–∏—Ç—å —É –±—É–¥—å-—è–∫—É —Å–º—É–≥—É).

#### –ü—Ä–∏–∫–ª–∞–¥
–î–ª—è `Fs = 44_000` —ñ `N = 1024`:

$$
\Delta f \approx \frac{44\,000}{1024} \approx 43.07 \text{ –ì—Ü}
$$

–Ø–∫—â–æ `IND_BANDS` –æ—Ö–æ–ø–ª—é—î –±—ñ–Ω–∏ `k_min = 1` ‚Ä¶ `k_max = 418`, —Ç–æ–¥—ñ:
- $f_{min} \approx 1 \cdot 43.07 \approx 43$ –ì—Ü
- $f_{max} \approx 418 \cdot 43.07 \approx 18.0$ –∫–ì—Ü

> –ü—Ä–∏–º—ñ—Ç–∫–∞: —Ä–µ–∞–ª—å–Ω—ñ –º–µ–∂—ñ –º–æ–∂—É—Ç—å –≤—ñ–¥—Ä—ñ–∑–Ω—è—Ç–∏—Å—å –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–æ–≥–æ, —è–∫—ñ —Å–∞–º–µ –±—ñ–Ω–∏/—Å–º—É–≥–∏ –≤–∫–ª—é—á–µ–Ω—ñ —É `IND_BANDS`.


---
## Frequency band power & dBFS

–ü—Ä–æ—î–∫—Ç –ø—Ä–∞—Ü—é—î –∑ **–ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—é (mean-square)** —É —á–∞—Å—Ç–æ—Ç–Ω—ñ–π –æ–±–ª–∞—Å—Ç—ñ.

### Bin power (`spec[k]`)
–ú–æ–¥—É–ª—å `fastfft` —É C –æ–±—á–∏—Å–ª—é—î `spec[k]` —è–∫ **–Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω—É –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –±—ñ–Ω—É** (mean-square) –¥–ª—è –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—å–æ–≥–æ —Å–ø–µ–∫—Ç—Ä–∞ real FFT (–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è FFT —Ç–∞ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞).

> –í–∞–∂–ª–∏–≤–æ: `spec[k] >= 0` —ñ –º–∞—î —É–∑–≥–æ–¥–∂–µ–Ω—É —Ñ—ñ–∑–∏—á–Ω—É —à–∫–∞–ª—É –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ, —Ç–æ–º—É –ø–æ–¥–∞–ª—å—à—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ –≤ Python –Ω–µ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó.

### Band power (—Å—É–º–∞ –ø–æ –±—ñ–Ω–∞—Ö)
–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å —Å–º—É–≥–∏ –∑ –±—ñ–Ω—ñ–≤ `[i, j)` —Ä–∞—Ö—É—î—Ç—å—Å—è —è–∫ —Å—É–º–∞ –ø–æ—Ç—É–∂–Ω–æ—Å—Ç–µ–π –±—ñ–Ω—ñ–≤:

- `E_band = Œ£ spec[k]`, `k = i..j-1`

–î–ª—è real FFT (–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ–π —Å–ø–µ–∫—Ç—Ä) –µ–Ω–µ—Ä–≥—ñ—è **–Ω–µ–≥–∞—Ç–∏–≤–Ω–∏—Ö —á–∞—Å—Ç–æ—Ç** –¥–∑–µ—Ä–∫–∞–ª—å–Ω–∞, —Ç–æ–º—É –¥–ª—è –±—ñ–Ω—ñ–≤, –≤—ñ–¥–º—ñ–Ω–Ω–∏—Ö –≤—ñ–¥ DC —Ç–∞ Nyquist, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –º–Ω–æ–∂–Ω–∏–∫ `√ó2`.

### dBFS reference

dBFS –≤–∏–∑–Ω–∞—á–µ–Ω–æ –≤—ñ–¥–Ω–æ—Å–Ω–æ RMS-–ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ –ø–æ–≤–Ω–æ–º–∞—Å—à—Ç–∞–±–Ω–æ–≥–æ —Å–∏–Ω—É—Å–∞:
```python
FS_RMS2 = (32767**2) / 2
```

–¢–æ–±—Ç–æ `0 dBFS` –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –ø–æ–≤–Ω–æ–º–∞—Å—à—Ç–∞–±–Ω–æ–º—É —Å–∏–Ω—É—Å—É —É —à–∫–∞–ª—ñ `int16` (peak = 32767), –∞ –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∏–∂—á–µ `0 dBFS` ‚Äî —Å–∏–≥–Ω–∞–ª–∞–º –∑ –º–µ–Ω—à–æ—é –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—é.

---


## üìà –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å 

–ö–∞–¥—Ä –≤–∫–ª—é—á–∞—î:
- —á–∞—Å –∑–∞—Ö–≤–∞—Ç—É: `FFT_SIZE / Fs` (–¥–ª—è 1024/44k ‚âà 23.27 ms)
- FFT (–¥–ª—è N=1024 + –≤—ñ–∫–Ω–æ ‚âà 35 ms)
- –∞–≥—Ä–µ–≥–∞—Ü—ñ—è —Å–º—É–≥ + AGC (‚âà 12 ms)
- –≤–∏–≤—ñ–¥ WS2812B: `np.write()` (–¥–ª—è 256 LED —Ç–∏–ø–æ–≤–æ ~7‚Äì8 ms)

–§–∞–∫—Ç–∏—á–Ω–∏–π FPS –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥:
- —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó `fastfft`
- –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ AGC/–ª–æ–≥–∞—Ä–∏—Ñ–º—ñ–≤
- —è—Å–∫—Ä–∞–≤–æ—Å—Ç—ñ/–æ–Ω–æ–≤–ª–µ–Ω–Ω—è LED —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ø–æ—Ç–æ–∫—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è  

–£ –ø—Ä–æ—î–∫—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ 2 —è–¥—Ä–∞ RP2040:  
- **Core0**: –∑–∞—Ö–≤–∞—Ç ADC (`FFT_SIZE/Fs`), FFT, –∞–≥—Ä–µ–≥–∞—Ü—ñ—è —Å–º—É–≥, AGC, –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ `spec_back/max_back` —ñ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—è –∫–∞–¥—Ä—É (swap).
- **Core1**: —Ä–µ–Ω–¥–µ—Ä –±—É—Ñ–µ—Ä–∞ (`viper`) —Ç–∞ –≤–∏–≤—ñ–¥ –Ω–∞ –º–∞—Ç—Ä–∏—Ü—é `np.write()` (WS2812B).

–¢–æ–º—É `np.write()` **–Ω–µ –∑–±—ñ–ª—å—à—É—î –ª–∞—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å DSP-–∫–∞–¥—Ä–∞ –Ω–∞ Core0** —É —Ä–µ–∂–∏–º—ñ `DROP_FRAMES=True`,
–∞–ª–µ –æ–±–º–µ–∂—É—î **–º–∞–∫—Å–∏–º–∞–ª—å–Ω—É —á–∞—Å—Ç–æ—Ç—É –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω–¥–∏–∫–∞—Ü—ñ—ó** (–ø—Ä–æ–ø—É—Å–∫ –∫–∞–¥—Ä—ñ–≤ –º–æ–∂–ª–∏–≤–∏–π, —è–∫—â–æ Core0 –≥–µ–Ω–µ—Ä—É—î –∫–∞–¥—Ä–∏ —à–≤–∏–¥—à–µ, –Ω—ñ–∂ Core1 –≤—Å—Ç–∏–≥–∞—î —ó—Ö –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏).  
–£ —Ä–µ–∂–∏–º—ñ `DROP_FRAMES=False` Core0 –æ—á—ñ–∫—É—î, –¥–æ–∫–∏ Core1 –∑–∞–±–µ—Ä–µ –∫–∞–¥—Ä, —ñ —Ç–æ–¥—ñ `np.write()` –Ω–∞–ø—Ä—è–º—É –æ–±–º–µ–∂—É—î —á–∞—Å—Ç–æ—Ç—É –≤—Å—ñ—î—ó —Å–∏—Å—Ç–µ–º–∏.

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó (–±–µ–∑ AA-—Ñ—ñ–ª—å—Ç—Ä–∞)
–Ø–∫—â–æ —É –≤–µ—Ä—Ö–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ —Å–ø–µ–∫—Ç—Ä–∞ –ø–æ–º—ñ—Ç–Ω—ñ ‚Äú–¥–∏–≤–Ω—ñ‚Äù –ø—ñ–∫–∏/—à—É–º:
- –æ–±–º–µ–∂–∏—Ç–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–æ 12‚Äì16 –∫–ì—Ü —á–µ—Ä–µ–∑ `IND_BANDS`
- –¥–æ–¥–∞—Ç–∏ –ø—Ä–æ—Å—Ç–∏–π RC low-pass –ø–µ—Ä–µ–¥ ADC (1-–π –ø–æ—Ä—è–¥–æ–∫):
  - –ø—Ä–∏–∫–ª–∞–¥: R=1 –∫Œ© –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ, C=10 –Ω–§ –Ω–∞ GND (fc ‚âà 16 –∫–ì—Ü)

---
## :hammer: –ü—Ä–∏–∫–ª–∞–¥ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—ó —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó  
–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –º–æ–¥—É–ª—å MAX9814 (–º—ñ–∫—Ä–æ—Ñ–æ–Ω + –ø—ñ–¥—Å–∏–ª—é–≤–∞—á).
### –í—Ö—ñ–¥–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏

- `Fs = 40_000` –ì—Ü  
- `IND_BANDS = (2, 1, 1, 1, 1, 1, 1, 5, 6, 11, 15, 24, 35, 53, 80, 160)`

–ö—Ä–æ–∫ –ø–æ —á–∞—Å—Ç–æ—Ç—ñ (1 –±—ñ–Ω):

- `Œîf = Fs / N = 40_000 / 1024 = 39.0625 –ì—Ü/–±—ñ–Ω`

–ß–∞—Å—Ç–æ—Ç–∞, —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –±—ñ–Ω—É `k`:

- `f(k) = k * Œîf`

–î–ª—è —Å–º—É–≥–∏ –∑ –±—ñ–Ω—ñ–≤ `k_start .. k_end` (–≤–∫–ª—é—á–Ω–æ):
- –Ω–∏–∂–Ω—è –º–µ–∂–∞: `f_min = k_start * Œîf`
- –≤–µ—Ä—Ö–Ω—è –º–µ–∂–∞: `f_max = (k_end + 1) * Œîf`  
  (–≤–µ—Ä—Ö–Ω—è –º–µ–∂–∞ –ø–æ –ø—Ä–∞–≤—ñ–π –≥—Ä–∞–Ω–∏—Ü—ñ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –±—ñ–Ω—É)

### –ú–µ–∂—ñ —Å–º—É–≥

> –§–æ—Ä–º–∞—Ç –±—ñ–Ω—ñ–≤: `k_start .. k_end` (–≤–∫–ª—é—á–Ω–æ)  
> –®–∏—Ä–∏–Ω–∞: –∫—ñ–ª—å–∫—ñ—Å—Ç—å –±—ñ–Ω—ñ–≤ —É —Å–º—É–∑—ñ

| –°–º—É–≥–∞ | –ë—ñ–Ω–∏ (k)    | –®–∏—Ä–∏–Ω–∞ (–±—ñ–Ω–∏) | –î—ñ–∞–ø–∞–∑–æ–Ω, –ì—Ü            |
|------:|-------------|--------------:|-------------------------|
| 1     | 1..2        | 2             | 39.1 ‚Ä¶ 117.2            |
| 2     | 3..3        | 1             | 117.2 ‚Ä¶ 156.3           |
| 3     | 4..4        | 1             | 156.3 ‚Ä¶ 195.3           |
| 4     | 5..5        | 1             | 195.3 ‚Ä¶ 234.4           |
| 5     | 6..6        | 1             | 234.4 ‚Ä¶ 273.4           |
| 6     | 7..7        | 1             | 273.4 ‚Ä¶ 312.5           |
| 7     | 8..8        | 1             | 312.5 ‚Ä¶ 351.6           |
| 8     | 9..13       | 5             | 351.6 ‚Ä¶ 546.9           |
| 9     | 14..19      | 6             | 546.9 ‚Ä¶ 781.3           |
| 10    | 20..30      | 11            | 781.3 ‚Ä¶ 1210.9          |
| 11    | 31..45      | 15            | 1210.9 ‚Ä¶ 1796.9         |
| 12    | 46..69      | 24            | 1796.9 ‚Ä¶ 2734.4         |
| 13    | 70..104     | 35            | 2734.4 ‚Ä¶ 4101.6         |
| 14    | 105..157    | 53            | 4101.6 ‚Ä¶ 6171.9         |
| 15    | 158..237    | 80            | 6171.9 ‚Ä¶ 9296.9         |
| 16    | 238..397    | 160           | 9296.9 ‚Ä¶ 15546.9        |

### –ü—ñ–¥—Å—É–º–æ–∫ –ø–æ–∫—Ä–∏—Ç—Ç—è

- –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –±—ñ–Ω—ñ–≤ —É 16 —Å–º—É–≥–∞—Ö: `Œ£ IND_BANDS = 397`
- –û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∏–π –¥—ñ–∞–ø–∞–∑–æ–Ω –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è: **‚âà 39 –ì—Ü ‚Ä¶ 15.55 –∫–ì—Ü**  

Nyquist –ø—Ä–∏ `Fs=40 –∫–ì—Ü`: `f_Nyq = Fs/2 = 20 –∫–ì—Ü`  
–í–µ—Ä—Ö–Ω—è —á–∞—Å—Ç–∏–Ω–∞ **~15.55‚Ä¶20 –∫–ì—Ü** —Å–≤—ñ–¥–æ–º–æ –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è.  

### Demo
![frame_12 5s](https://github.com/user-attachments/assets/bb825863-c67d-4cb1-aeee-b3d881acf463)
 https://youtube.com/shorts/MJnGREBaDtQ  

---
## üìÑ Credits and License
- Licensed under MIT.
- **kissFFT**: This project uses the [kissFFT](https://github.com/mborgerding/kissfft) library by Mark Borgerding, licensed under the **BSD 3-Clause License**.
